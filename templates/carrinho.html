<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='imagens/faviconn.png') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrinho de Compras</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 30px auto;
      background-color: #f0f2f5;
      color: #333;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: 10px;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 25px;
      color: #222;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
      font-weight: 700;
    }

    .product-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .product-item {
      background: white;
      padding: 18px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .product-info {
      display: flex;
      align-items: center;
      gap: 18px;
    }

    .product-info img {
      width: 90px;
      height: 90px;
      object-fit: contain;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    .qty-box {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .qty-btn {
      background: #3498db;
      color: white;
      border: none;
      font-size: 18px;
      width: 35px;
      height: 35px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .qty-number {
      font-size: 18px;
      padding: 5px 12px;
      border-radius: 6px;
      background: #eee;
    }

    .remove-btn {
      background: #e74c3c;
      border: none;
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    .limpar-btn {
      background-color: #2980b9;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
    }

    .back-link {
      margin-left: 20px;
      font-size: 16px;
      text-decoration: none;
      color: #3498db;
      font-weight: bold;
    }

    .payment-form {
      margin-top: 40px;
      padding: 25px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .payment-form h2 {
      margin-bottom: 20px;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }

    .payment-form label {
      font-weight: bold;
    }

    .payment-form input {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 2px solid #ccc;
      border-radius: 8px;
    }

    .payment-form button {
      background: #3498db;
      color: white;
      width: 100%;
      padding: 15px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .cart-buttons {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 25px 0;
}
.topo-carrinho {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px; /* dist√¢ncia entre o topo e o resto da p√°gina */
}

.frete-btn {
  background-color: #3498db;
  color: white;
  padding: 10px 18px;
  text-decoration: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 14px;
  transition: 0.3s;
}

.frete-btn:hover {
  background-color: #21618c;
}

  </style>
</head>

<body>

<div class="topo-carrinho">
  <h1>Carrinho de Compras</h1>

  <a href="{{ url_for('frete_gratis') }}" class="frete-btn">
    Informa√ß√µes de Frete Gr√°tis
  </a>
</div>

{% if itens %}

<ul class="product-list">
  {% for item in itens %}
  <li class="product-item">
    <div class="product-info">
      <img src="{{ url_for('static', filename='uploads/' ~ item.produto.imagem) }}" />

      <div>
        <strong>{{ item.produto.nome }}</strong><br>
        R$ {{ "%.2f"|format(item.subtotal) }}
        <br><br>
{% if tem_frete_gratis %}
    <p style="color: green; font-size:18px; font-weight:bold; margin:20px 0;">
      üéâ Voc√™ ganhou FRETE GR√ÅTIS!
    </p>
{% else %}
    <p style="color: #d35400; font-size:18px; font-weight:bold; margin:20px 0;">
      üõí Faltam <span style="color:#c0392b;">R$ {{ "%.2f"|format(valor_faltante) }}</span> para voc√™ ganhar FRETE GR√ÅTIS!
    </p>
{% endif %}

        <div class="qty-box">

  <form method="POST" action="{{ url_for('alterar_quantidade', produto_id=item.produto.id) }}">
    <input type="hidden" name="acao" value="menos">
    <button type="submit" class="qty-btn">‚àí</button>
  </form>

  <span class="qty-number">{{ item.quantidade }}</span>

  <form method="POST" action="{{ url_for('alterar_quantidade', produto_id=item.produto.id) }}">
    <input type="hidden" name="acao" value="mais">
    <button type="submit" class="qty-btn">+</button>
  </form>

</div>

      </div>
    </div>

    <form method="POST" action="{{ url_for('remover_do_carrinho', produto_id=item.produto.id) }}">
      <button class="remove-btn">Remover</button>
    </form>
  </li>
  {% endfor %}
</ul>
<div style="
  margin-top: 25px;
  font-size: 22px;
  font-weight: bold;
  text-align: right;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
">
<div style="margin-bottom: 20px; padding: 15px; background: #eaf3ff; border-radius: 8px;">
  
  <form method="POST" action="{{ url_for('calcular_frete') }}">
      <label><strong>Calcular Frete</strong></label><br>
      <input type="text" name="cep" placeholder="Digite seu CEP" 
             value="{{ cep_usuario if cep_usuario else '' }}"
             style="padding: 10px; width: 200px; margin-top: 8px;" required>
      
      <button type="submit" 
              style="padding: 10px 20px; background:#3498db; color:white; border:none; border-radius:6px; cursor:pointer;">
        Calcular
      </button>
  </form>

  {% if frete is not none %}
      <p style="margin-top: 10px;">
        üì¶ Frete: <strong>R$ {{ "%.2f"|format(frete) }}</strong>
        <br>
        Total com Frete: <strong>R$ {{ "%.2f"|format(total_geral) }}</strong>
      </p>

      {% if frete == 0 %}
        <p style="color: green; font-weight: bold;">üéâ Frete gr√°tis aplicado!</p>
      {% endif %}
  {% endif %}
</div>

  Total do Carrinho: R$ {{ "%.2f"|format(total) }}
</div>

<div class="cart-buttons">
    <a href="{{ url_for('index') }}" class="limpar-btn" style="text-decoration:none;">
        ‚Üê Continuar Comprando
    </a>

    <form method="POST" action="{{ url_for('limpar_carrinho') }}">
        <button class="limpar-btn">Limpar Carrinho</button>
    </form>
</div>

<div class="payment-form">
  <h2>Pagamento</h2>

  <form method="POST" action="{{ url_for('finalizar_compra') }}">
    <label>Nome no cart√£o</label>
    <input type="text" name="nome" required>

<label>N√∫mero do cart√£o</label>
<input type="text" name="numero_cartao" id="numero_cartao" maxlength="16" required>

<label>Validade (MM/AA)</label>
<input type="text" name="validade" id="validade" maxlength="5" required>

<label>CVV</label>
<input type="text" name="cvv" id="cvv" maxlength="3" required>


    <button type="submit">Finalizar Compra</button>
  </form>
</div>

{% else %}
<h3>Seu carrinho est√° vazio!</h3>
<a href="{{ url_for('index') }}">Voltar √† loja</a>
{% endif %}
<script>
// Apenas n√∫meros no n√∫mero do cart√£o
document.getElementById("numero_cartao").addEventListener("input", function () {
    this.value = this.value.replace(/\D/g, "").slice(0, 16);
});

// Apenas n√∫meros no CVV
document.getElementById("cvv").addEventListener("input", function () {
    this.value = this.value.replace(/\D/g, "").slice(0, 3);
});

// Formatar validade como MM/AA
document.getElementById("validade").addEventListener("input", function () {
    let val = this.value.replace(/\D/g, "").slice(0, 4);

    if (val.length >= 3) {
        this.value = val.slice(0, 2) + "/" + val.slice(2, 4);
    } else {
        this.value = val;
    }
});
</script>

</body>
</html>
